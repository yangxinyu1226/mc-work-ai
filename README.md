# Minecraft AI Builder

This project is an automated Minecraft building system powered by Large Language Models (LLMs). It allows players to generate complex structures and landscapes in Minecraft using simple natural language commands.

## Core Components & Folder Structure

The project is organized into several key Python scripts and directories:

-   `src/`: Contains core Python scripts for system utilities, RCON communication, and the main planning logic.
    -   `main_planner.py`: **The Chief Planner** - The central controller of the system. It listens for player commands, decomposes tasks for various functional generators, and coordinates the final construction.
    -   `mc_listener.py`: **Command Listener** - Monitors Minecraft server logs for player chat commands (starting with `!build`) and sends them to the Chief Planner.
    -   `rcon_client.py`: **RCON Client** - Responsible for RCON communication with the Minecraft server, executing block placement commands, and retrieving player positions.
    -   `key_manager.py`: **API Key Manager** - Manages and rotates DeepSeek API keys securely, ensuring stable and load-balanced API calls.
    -   `util.py`: **General Utilities** - Contains common functions for LLM interaction, JSON file reading/writing, and geometric block generation.
-   `generators/`: Houses various **Functional Generators**. Each generator specializes in creating specific types of building components or landscapes (e.g., buildings, terrain, lighting). They call LLMs to design details and use underlying geometric primitive generators to construct blocks.
-   `supervisor/`:
    -   `supervisor.py`: **The Supervisor** - After all building components are generated, it coordinates an LLM to assemble these components into a complete, logical, and conflict-free construction plan.
-   `config/`: Stores configuration files for API keys and RCON settings.
    -   `api_keys_list.json`: List of DeepSeek API keys.
    -   `rcon_settings.json`: Minecraft server RCON connection details.
-   `build/`: Temporary directory where generated component plans (JSON files) are stored before final assembly.
-   `command_queue.json`: A queue file where `mc_listener.py` writes player commands for `main_planner.py` to pick up.
-   `final_build_plan.json`: The final, assembled construction plan generated by the Supervisor, ready for execution.
-   `开发计划.txt` (Development Plan.txt): A log or scratchpad for development notes and debugging output.
-   `提示词模板.txt` (Prompt Templates.txt): Likely contains templates or examples for LLM prompts.
-   `bug.txt`: A file for logging or noting down bugs.

## Underlying Principles

The system operates on a layered and modular design, emphasizing LLM-driven intelligence at various stages:

1.  **LLM-driven Task Decomposition**: The Chief Planner uses an LLM to break down a high-level natural language player command into smaller, manageable sub-tasks, each assigned to a specialized functional generator.
2.  **Modular Generator Design**: Each functional generator is a self-contained unit, responsible for a specific aspect of construction. They interact with LLMs to design their part and then translate these designs into Minecraft block commands using geometric primitive functions.
3.  **Hierarchical Planning & Assembly**:
    *   **Generators**: Focus on detailed design of individual components.
    *   **Supervisor**: Acts as a higher-level orchestrator, taking the generated components and using an LLM to intelligently arrange them in space, resolving potential conflicts and ensuring logical coherence.
4.  **RCON for In-Game Execution**: The final block commands are sent to the Minecraft server via RCON, allowing for real-time construction.

## Workflow

1.  **Player Command**: A player enters a command like `!build <your building description>` in Minecraft chat.
2.  **Command Listening**: `mc_listener.py` captures the command and adds it to `command_queue.json`.
3.  **Task Decomposition**: `main_planner.py` reads the command, and its internal LLM decomposes the high-level description into multiple sub-tasks for different functional generators.
4.  **Component Generation**: Each functional generator receives its sub-task description. Its internal LLM designs the specific block layout (using geometric primitives), and the generator saves the resulting block list (along with spatial metadata) to a JSON file in the `build/` directory.
5.  **Final Assembly**: `supervisor.py` reads all component JSON files from `build/`. Its internal LLM plans the relative positions and assembly methods of these components, ensuring no overlaps and logical placement, then generates `final_build_plan.json`.
6.  **RCON Construction**: `main_planner.py` reads `final_build_plan.json`, gets the player's current position as a reference point, and sends `setblock` commands to the Minecraft server via `rcon_client.py` to complete the construction.

## Setup & Running

### 0. Minecraft Server Setup (Spigot)

To use this AI builder, you need a running Minecraft server with RCON enabled. Spigot is a popular choice for its performance and plugin support.

**Prerequisites:**
*   Java Development Kit (JDK) 17 or newer.

**Steps:**

1.  **Download BuildTools**: Get `BuildTools.jar` from the official SpigotMC website: [https://www.spigotmc.org/wiki/buildtools/](https://www.spigotmc.org/wiki/buildtools/)
2.  **Run BuildTools**: Open a command prompt in the directory where you downloaded `BuildTools.jar` and run:
    ```bash
    java -jar BuildTools.jar --rev 1.20.4 # Or your desired Minecraft version
    ```
    This will download and compile the Spigot server JAR (e.g., `spigot-1.20.4.jar`).
3.  **Create a Server Directory**: Create a new folder for your Minecraft server (e.g., `my_minecraft_server`). Move the generated `spigot-1.20.4.jar` into this folder.
4.  **Accept EULA**: The first time you run the server, it will create an `eula.txt` file. Open it and change `eula=false` to `eula=true`.
5.  **Run the Server**: In your server directory, create a `run.bat` (Windows) or `run.sh` (Linux/macOS) file with the following content:
    ```bash
    # For Windows (run.bat)
    java -Xmx2G -Xms1G -jar spigot-1.20.4.jar nogui
    pause

    # For Linux/macOS (run.sh)
    #!/bin/bash
    java -Xmx2G -Xms1G -jar spigot-1.20.4.jar nogui
    ```
    Run this script to start your server.
6.  **Enable RCON**: 
    *   Stop your server.
    *   Open `server.properties` in your server directory.
    *   Change the following lines (or add them if missing):
        ```properties
        enable-rcon=true
        rcon.port=25575 # Default RCON port, can be changed
        rcon.password=your_rcon_password # IMPORTANT: Choose a strong password
        ```
    *   Save the file and restart your server.
7.  **Log File Path**: Note the path to your server's `logs/latest.log` file. You'll need this for the `rcon_settings.json` configuration.

### 1. Environment Preparation

Ensure you have Python 3.x installed. Then, install the required Python libraries:

```bash
pip install openai mcrcon
```

### 2. Configuration

-   **API Keys**: Open `config/api_keys_list.json` and fill in your DeepSeek API keys. You can add multiple keys; the system will automatically rotate through them.
    ```json
    [
      "sk-xxxxxxxxxxxxxxxxxxxxxxxx",
      "sk-yyyyyyyyyyyyyyyyyyyyyyyy"
    ]
    ```
-   **RCON Settings**: Open `config/rcon_settings.json` and configure your Minecraft server RCON connection information. `player_id` can be any valid player name on the server.
    ```json
    {
      "server_address": "localhost",
      "rcon_password": "your_rcon_password",
      "player_id": "AnyPlayerNameOnServer",
      "log_file_path": "C:/path/to/your/minecraft/server/logs/latest.log"
    }
    ```

### 3. Running the System

Open two separate command prompt windows and run the following scripts:

**Window 1 (Chief Planner)**:

```bash
python src/main_planner.py
```

**Window 2 (Command Listener)**:

```bash
python src/mc_listener.py
```

These windows need to remain open.

### 4. In-Game Usage

Enter a command in your Minecraft chat:

```
!build <Your building description>
```

For example:

```
!build Build a simple wooden house
```

The system will automatically process your request and construct the building near your current position.

---

# Minecraft AI 建筑大师

本项目是一个基于大语言模型（LLM）的《我的世界》自动化建筑系统。它允许玩家通过简单的自然语言指令，在《我的世界》游戏中自动生成复杂的建筑和景观。

## 核心组件与文件夹结构

本项目由以下几个核心Python脚本和目录组成：

-   `src/`：包含系统工具、RCON通信和主规划逻辑的核心Python脚本。
    -   `main_planner.py`：**总规划师** - 系统的核心控制器。它监听玩家指令，将任务分解给不同的功能性生成器，并协调最终的建筑施工。
    -   `mc_listener.py`：**指令监听器** - 监听Minecraft服务器日志中的玩家聊天指令（以 `!build` 开头），并将指令发送给总规划师。
    -   `rcon_client.py`：**RCON客户端** - 负责与Minecraft服务器进行RCON通信，执行方块放置指令，并获取玩家位置。
    -   `key_manager.py`：**API密钥管理器** - 负责安全地管理和轮换DeepSeek API密钥，确保API调用的稳定性和负载均衡。
    -   `util.py`：**通用工具** - 包含LLM交互、JSON文件读写、几何方块生成等通用函数。
-   `generators/`：存放各种**功能性生成器**。每个生成器专注于生成特定类型的建筑部件或景观（例如建筑、地形、灯光等）。它们会调用大模型来设计细节，并使用底层的几何图元生成器来构建方块。
-   `supervisor/`：
    -   `supervisor.py`：**监理师** - 在所有建筑部件生成后，协调大模型将这些部件组装成一个完整、有逻辑且无冲突的建筑方案。
-   `config/`：存储API密钥和RCON设置的配置文件。
    -   `api_keys_list.json`：DeepSeek API密钥列表。
    -   `rcon_settings.json`：Minecraft服务器RCON连接详情。
-   `build/`：临时目录，用于在最终组装前存储生成的组件计划（JSON文件）。
-   `command_queue.json`：一个队列文件，`mc_listener.py`将玩家指令写入其中，供`main_planner.py`读取。
-   `final_build_plan.json`：由监理师生成的最终组装好的建筑计划，准备执行。
-   `开发计划.txt`：开发笔记和调试输出的日志或草稿文件。
-   `提示词模板.txt`：可能包含LLM提示词的模板或示例。
-   `bug.txt`：用于记录或备注bug的文件。

## 原理概述

系统采用分层和模块化的设计，在各个阶段都强调LLM驱动的智能：

1.  **LLM驱动的任务分解**：总规划师使用LLM将玩家的高层级自然语言指令分解为更小、更易管理的子任务，每个子任务都分配给一个专门的功能性生成器。
2.  **模块化生成器设计**：每个功能性生成器都是一个独立的单元，负责建筑的特定方面。它们与LLM交互以设计其部分，然后使用几何图元函数将这些设计转换为Minecraft方块指令。
3.  **分层规划与组装**：
    *   **生成器**：专注于单个组件的详细设计。
    *   **监理师**：作为更高层次的协调者，接收生成的组件，并使用LLM智能地在空间中排列它们，解决潜在冲突并确保逻辑一致性。
4.  **RCON进行游戏内执行**：最终的方块指令通过RCON发送到Minecraft服务器，实现实时建造。

## 工作流程

1.  **玩家指令**：玩家在Minecraft聊天中输入 `!build <你的建筑描述>`。
2.  **指令监听**：`mc_listener.py` 捕获指令，并将其添加到 `command_queue.json` 队列。
3.  **任务分解**：`main_planner.py` 从队列中读取指令，并调用其内部的大模型（LLM）将高层级描述分解为多个子任务，分配给不同的功能性生成器。
4.  **部件生成**：每个功能性生成器接收其子任务的自然语言描述。其内部的大模型（LLM）设计具体的方块布局（使用几何图元），生成器将生成的方块列表（以及空间元数据）保存到 `build/` 目录下的JSON文件中。
5.  **最终组装**：`supervisor.py` 读取 `build/` 目录下的所有组件JSON文件。其内部的大模型（LLM）规划这些部件的相对位置和组装方式，确保无重叠和逻辑放置，然后生成 `final_build_plan.json`。
6.  **RCON施工**：`main_planner.py` 读取 `final_build_plan.json`，获取发出指令玩家的当前位置作为基准点，然后通过 `rcon_client.py` 向Minecraft服务器发送 `setblock` 命令，完成建筑施工。

## 设置与运行

### 0. Minecraft 服务器设置 (Spigot)

要使用此AI建筑大师，您需要一个运行中的Minecraft服务器并启用RCON。Spigot因其性能和插件支持而成为热门选择。

**先决条件：**
*   Java Development Kit (JDK) 17 或更高版本。

**步骤：**

1.  **下载 BuildTools**：从 SpigotMC 官方网站获取 `BuildTools.jar`：[https://www.spigotmc.org/wiki/buildtools/](https://www.spigotmc.org/wiki/buildtools/)
2.  **运行 BuildTools**：在您下载 `BuildTools.jar` 的目录中打开命令行，运行：
    ```bash
    java -jar BuildTools.jar --rev 1.20.4 # 或您想要的Minecraft版本
    ```
    这将下载并编译 Spigot 服务器 JAR 文件（例如 `spigot-1.20.4.jar`）。
3.  **创建服务器目录**：为您的Minecraft服务器创建一个新文件夹（例如 `my_minecraft_server`）。将生成的 `spigot-1.20.4.jar` 移动到此文件夹中。
4.  **接受 EULA**：首次运行服务器时，它会创建一个 `eula.txt` 文件。打开它并将 `eula=false` 改为 `eula=true`。
5.  **运行服务器**：在您的服务器目录中，创建一个 `run.bat` (Windows) 或 `run.sh` (Linux/macOS) 文件，内容如下：
    ```bash
    # 适用于 Windows (run.bat)
    java -Xmx2G -Xms1G -jar spigot-1.20.4.jar nogui
    pause

    # 适用于 Linux/macOS (run.sh)
    #!/bin/bash
    java -Xmx2G -Xms1G -jar spigot-1.20.4.jar nogui
    ```
    运行此脚本以启动您的服务器。
6.  **启用 RCON**： 
    *   停止您的服务器。
    *   打开服务器目录中的 `server.properties` 文件。
    *   更改以下行（如果缺失则添加）：
        ```properties
        enable-rcon=true
        rcon.port=25575 # 默认RCON端口，可更改
        rcon.password=your_rcon_password # 重要：选择一个强密码
        ```
    *   保存文件并重新启动服务器。
7.  **日志文件路径**：记下您的服务器 `logs/latest.log` 文件的路径。您将在 `rcon_settings.json` 配置中用到它。

### 1. Environment Preparation

Ensure you have Python 3.x installed. Then, install the required Python libraries:

```bash
pip install openai mcrcon
```

### 2. Configuration

-   **API Keys**: Open `config/api_keys_list.json` and fill in your DeepSeek API keys. You can add multiple keys; the system will automatically rotate through them.
    ```json
    [
      "sk-xxxxxxxxxxxxxxxxxxxxxxxx",
      "sk-yyyyyyyyyyyyyyyyyyyyyyyy"
    ]
    ```
-   **RCON Settings**: Open `config/rcon_settings.json` and configure your Minecraft server RCON connection information. `player_id` can be any valid player name on the server.
    ```json
    {
      "server_address": "localhost",
      "rcon_password": "your_rcon_password",
      "player_id": "AnyPlayerNameOnServer",
      "log_file_path": "C:/path/to/your/minecraft/server/logs/latest.log"
    }
    ```

### 3. Running the System

Open two separate command prompt windows and run the following scripts:

**Window 1 (Chief Planner)**:

```bash
python src/main_planner.py
```

**Window 2 (Command Listener)**:

```bash
python src/mc_listener.py
```

These windows need to remain open.

### 4. In-Game Usage

Enter a command in your Minecraft chat:

```
!build <Your building description>
```

For example:

```
!build Build a simple wooden house
```

The system will automatically process your request and construct the building near your current position.